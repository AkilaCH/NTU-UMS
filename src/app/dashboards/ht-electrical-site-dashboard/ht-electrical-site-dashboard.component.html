<div class="card main-card-height" id="main-dashboard-ht">
    <div class="card-header p-0 pl-2 pr-3">
        <div class="d-none d-xl-block">
            <span class="d-inline-block pl-3 pt-3 pb-3 font-secondary header-title">Electrical High Tension</span>
            <span class="tab-primary float-right font-primary" (click)="setTabIndex(2)"
                [ngClass]="{'active': tabIndex == 2}">Substation Breakdown</span>
            <span class="tab-primary float-right font-primary" (click)="setTabIndex(1)"
                [ngClass]="{'active': tabIndex == 1}">Loop Distribution</span>
            <span class="tab-primary float-right font-primary" (click)="setTabIndex(0)"
                [ngClass]="{'active': tabIndex == 0}">Overview</span>
        </div>
        <div class="form-group row mb-0 row d-xl-none pr-2">
            <label class="col-6 col-sm-6 col-form-label">Electrical High Tension</label>
            <div class="col-6 col-sm-6 pl-0 pr-0">
            <app-combo-box class="select-box-dark"></app-combo-box>
                <select (change)="setTabIndex($event.target.value)" [(ngModel)]="tabIndex"
                    class="form-control mt-1 form-control-sm select-box-dark">
                    <option value="0">Overview</option>
                    <option value="1">Loop Distribution</option>
                    <option value="2">Substation Breakdown</option>
                </select>
            </div>
        </div>
    </div>
    <div class="card-body  card-scroll">
        <section *ngIf="tabIndex == 0">
            <div class="row ow-eq-height">
                <div class="col-md-4 p-1">
                    <div class="chart-card h-100">
                        <div class="chart-card-header">
                                <span>Overall Consumption</span>
                                <date-range-picker [disabled] = "!isDone.overollConsumptionData" *ngIf="_reload" [maxDate]="today" class="d-block" position="bottom-right"
                                    [(dateRange)]="overollConsumptionRange"
                                    (dateRangeChange)="overollConsumptionChanged()"></date-range-picker>
                        </div>
                        <div class="chart-card-body p-0">
                            <div class="row d-flex align-items-center justify-content-center h-100">
                                <div class="col-md-12 h-100 w-100">
                                    <app-chart-loader [isDone] = "isDone.overollConsumptionData">
                                        <app-data-pointer-none-image [color] = "this.colorMap.electric.secondary" [pointerText]="overollConsumptionData" [unit]="'kWh'" type="kwh"
                                            [description]="'Total Consumption'"></app-data-pointer-none-image>
                                    </app-chart-loader>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-8 p-1">
                    <div class="chart-card" id="30MinutConsumption">
                        <div class="chart-card-header">
                            <span class="header-title">30 min Consumption</span>
                            <div class="d-flex align-items-center">
                                <date-range-picker [disabled] = "!isDone.dailyConsumptionData" *ngIf="_reload" [maxDate]="_maxTodayConsumptionDate" [minDate] = "_minTodayConsumptionDate" (dateRangeChange)="onChangeTodayConsumption()"
                                                    [(dateRange)]="_todayConsumptionDate"
                                                    [isSingleDate]="'true'"
                                                    position="bottom-right"></date-range-picker>
                                <app-print-preview [className]="'position-gorelative'" [targetHtml] = "'30MinutConsumption'" [title]="'30 min Consumption'"></app-print-preview>
                            </div>
                        </div>
                        <div class="chart-card-body p-3 position-relative">
                            <app-total-comsumption [value] = "dailyConsumptionData.chart.total" [unit] = "'kWh'" [type] = "'kWh'"></app-total-comsumption>
                            <app-chart-loader [isDone] = "isDone.dailyConsumptionData">
                                <app-trend *ngIf="dailyConsumptionData" [dataSource]="dailyConsumptionData"></app-trend>
                            </app-chart-loader>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row ow-eq-height">
                <div class="col-md-4 p-1">
                    <div class="chart-card h-100" id="equipmentdistribution">
                        <div class="chart-card-header">
                            <span class="header-title">Loop Distribution</span>
                            <div class="d-flex align-items-center">
                                <date-range-picker [disabled] = "!isDone.substationDistribution" *ngIf="_reload" [maxDate]="today" class="d-block" position="bottom-right"
                                    [(dateRange)]="substationDistRange"
                                    (dateRangeChange)="loopDistributionChanged(0)"></date-range-picker>
                                <app-print-preview [className]="'position-gorelative'" [targetHtml] = "'equipmentdistribution'" [title]="'Loop Distribution'"></app-print-preview>
                            </div>
                        </div>
                        <div class="chart-card-body p-3 pie-chart-min-height position-relative">
                            <app-chart-loader [isDone] = "isDone.substationDistribution">
                                <app-pie *ngIf="substationDistribution" [dataSource]="substationDistribution"></app-pie>
                            </app-chart-loader>
                        </div>
                    </div>
                </div>
                <div class="col-md-8 p-1">
                    <div class="chart-card h-100" id="consumptionSummary">
                        <div class="chart-card-header">
                            <span class="header-title">Consumption Summary</span>
                            <div role="group" class="d-flex align-items-center" aria-label="Trend Log Modes">
                                <div class="chart-card-header" style="margin-right: 10px;">
                                    <span style="margin-right: 5px;">From:</span>
                                    <date-range-picker [disabled] = "!isDone.trendLogData" *ngIf="_reload && !_isMonth && !_isYear"  class="" (dateRangeChange)="onChangeTrendLogByDate(true)" [maxDate] = "_maxDate"
                                                        [(dateRange)]="_startDateTrendLog"
                                                        [isSingleDate]="'true'"
                                                        position="bottom-right"></date-range-picker>
                                    <month-date-pciker [disabled] = "!isDone.trendLogData" *ngIf="(_reload && _isMonth) || (_reload && _isYear)" [isYear]="_isYear" [(dateRange)]="_startDateTrendLog" (dateRangeChange)="onChangeTrendLogByDate(true)" [maxDate] ="today"></month-date-pciker>
                                    
                                </div>
                                <span>Last</span>
                                <button [disabled] = "!isDone.trendLogData" *ngFor="let item of _mapArrayTrendIndex" class="btn btn-primary btn-circle" [ngClass]="{'active': trendLogTabIndex == item.value}" (click)="setTrendLogData(item.value)">{{item.label}}</button>
                                <app-print-preview [className]="'position-gorelative'"  [targetHtml] = "'consumptionSummary'" [title]="'Consumption Summary'"></app-print-preview>

                                <!-- <button class="btn btn-primary btn-circle" [ngClass]="{'active': trendLogTabIndex == 0}" (click)="setTrendLogData(0)">7D</button>
                                <button class="btn btn-primary btn-circle" [ngClass]="{'active': trendLogTabIndex == 1}" (click)="setTrendLogData(1)">30D</button>
                                <button class="btn btn-primary btn-circle" [ngClass]="{'active': trendLogTabIndex == 2}" (click)="setTrendLogData(2)">12M</button>
                                <button class="btn btn-primary btn-circle" [ngClass]="{'active': trendLogTabIndex == 3}" (click)="setTrendLogData(3)">5Y</button> -->
                            </div>
                        </div>
                        <div class="chart-card-body p-3 position-relative">
                            <app-chart-loader [isDone] = "isDone.trendLogData">
                                <app-trend *ngIf="trendLogData" [dataSource]="trendLogData"></app-trend>
                            </app-chart-loader>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div class="chart-card m-1" *ngIf="tabIndex == 1">
          <div class="chart-card-body p-3 position-relative">
            <div class="eq-breackdown-position">
              <date-range-picker [disabled] = "!isDone.substationDistribution" *ngIf="_reload" [maxDate]="today" class="d-block" position="bottom-left"
                  [(dateRange)]="substationDistRange" (dateRangeChange)="loopDistributionChanged(1)">
              </date-range-picker>
            </div>
            <div>
                <app-print-preview [targetHtml] = "'main-dashboard-ht'" [title]="'Equipment Distribution'"></app-print-preview>
                <app-chart-loader [isDone] = "isDone.substationDistribution">
                    <app-doughnut2d *ngIf="substationDistribution" [fixedWidth]="true" [dataSource]="substationDistribution">
                    </app-doughnut2d>
                </app-chart-loader>
            </div>
          </div>
        </div>

        <div class="row" *ngIf="tabIndex == 2">
            <div class="col-md-12 col-lg-12 col-xl-12 pl-0 pr-0">
                <div class="col-md-12 col-lg-12 col-xl-12 pl-0 pr-0 pb-4">
                  <app-form-container fieldName="Filter Substation">
                    <app-ht-equipment-breakdown-filter [(loopId)]="breakdownLoopId" [(substationId)]="breakdownSubstationId" [(meterId)]="breakdownMeterId" [dataSource]="equipmentBreakdownData" [dateRange]="eqBreakDownFilter" [isSite]="true" (onFilter)="onEquipmentBreakdownFiltered($event)" (onDateRangeChanged)="onEqBreakdownDateChange($event)"></app-ht-equipment-breakdown-filter>
                  </app-form-container>
                </div>
                <app-data-table [isLoading]="tableLoading" [rows]="rows" [columns]="columns"></app-data-table>
            </div>
        </div>
    </div>
</div>
