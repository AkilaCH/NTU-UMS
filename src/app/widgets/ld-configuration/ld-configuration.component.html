<div *ngIf="!isLoading" class="mt-3 mb-3 row-limit">
    No of Rows &nbsp;<app-combo-box class="select-box-dark" [dataSource]="rowLimits" [fullWidth]="false" [selected]="2" [enableAll]="false" (selectedChange)="changeNoOfRows($event)"></app-combo-box>
</div>
<div *ngIf="!isLoading">
    <ngx-datatable
        class="dark"
        [columnMode]="ColumnMode.flex"
        [headerHeight]="50"
        [footerHeight]="50"
        [limit]="limit"
        rowHeight="auto"
        [rows]="rows">
        <ngx-datatable-column name="Action" [flexGrow]="1">
            <ng-template let-row="row" ngx-datatable-cell-template>
                <app-toggle-button
                    [switch]="row.status"
                    (switchChange)="onToggle($event, row)">
                </app-toggle-button>
            </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Scenario" [flexGrow]="3">
            <ng-template let-row="row" ngx-datatable-cell-template>
                <div *ngIf="row.edit" style="width: 320px;">
                    <app-combo-box
                        dark="false"
                        [enableAll]="false"
                        [selected]="row.scenarioId"
                        [dataSource]="[ {id: 1, name: 'Without sub meters between main ring meters'}, {id: 2, name: 'With sub meters between main ring meters'} ]"
                        (selectedChange)="onScenarioChange(row, $event)">
                    </app-combo-box>
                </div>
                <div *ngIf="!row.edit">{{ row.scenarioId == 1 ? 'Without sub meters between main ring meters' : row.scenarioId == 2 ? 'With sub meters between main ring meters' : 'N/A'}}</div>
            </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Ring Meter 1" [flexGrow]="1">
            <ng-template let-row="row" ngx-datatable-cell-template>
                <div *ngIf="row.edit">
                    <app-combo-box
                        dark="false"
                        [enableAll]="false"
                        [selected]="row.meterAId"
                        [dataSource]="meterList"
                        (selectedChange)="onMeterAChange(row, $event)">
                    </app-combo-box>
                </div>
                <div *ngIf="!row.edit">{{ row.meterA }}</div>
            </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Ring Meter 2" [flexGrow]="1">
            <ng-template let-row="row" ngx-datatable-cell-template>
                <div *ngIf="row.edit">
                    <app-combo-box
                        dark="false"
                        [enableAll]="false"
                        [selected]="row.meterBId"
                        [dataSource]="meterList"
                        (selectedChange)="onMeterBChange(row, $event)">
                    </app-combo-box>
                </div>
                <div *ngIf="!row.edit">{{ row.meterB }}</div>
            </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Sub Meters" [flexGrow]="3">
            <ng-template let-row="row" ngx-datatable-cell-template>
                <div *ngIf="row.edit && row.scenarioId == 2">
                    <a (click)="openMeterPopup(row)" class="popup-link">
                        <span *ngIf="row.subMeters.length == 0">Add Meters</span>
                        <span *ngFor="let subMeter of row.subMeters">{{ subMeter.meterName }},&nbsp;</span>
                    </a>
                </div>
                <div *ngIf="!row.edit && row.scenarioId == 2">
                    <span *ngFor="let subMeter of row.subMeters">{{ subMeter.meterName }},&nbsp;</span>
                </div>
            </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Action" [flexGrow]="1">
            <ng-template let-row="row" ngx-datatable-cell-template>
                <div *ngIf="!row.edit" class="btn-group w-100" role="group" aria-label="Actions">
                    <button [disabled]="!row.status" (click)="editClick(row)" class="btn btn-primary btn-green btn-sm form-control search-box">Edit</button>
                    <button [disabled]="!row.status" (click)="deleteClick(row.id)" class="btn btn-primary btn-red btn-sm form-control search-box">Delete</button>
                </div>
                <div *ngIf="row.edit" class="btn-group w-100" role="group" aria-label="Actions" >
                    <button (click)="saveClick(row)" class="btn btn-primary btn-sm btn-green form-control search-box">Save</button>
                    <button (click)="cancelClick(row)" class="btn btn-primary btn-sm btn-red form-control search-box">Cancel</button>
                </div>
            </ng-template>
        </ngx-datatable-column>
    </ngx-datatable>
    <div class="d-flex justify-content-end mt-3  mb-3">
        <button (click)="addNewScenario()" class="d-inline-block clickable  btn-sm btn btn-primary mr-2 ml-2 float-left">
          <fa-icon [icon]="plusIcon"></fa-icon> Add New Scenario
        </button>
    </div>
</div>
<div *ngIf="isLoading" class="loading-area">
    <img  alt="loader" class="loading-icon" src="assets/img/loader.svg" />
</div>